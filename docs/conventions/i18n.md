# i18n Conventions

## Quick Reference

```vue
<template>
  <p>{{ $t('common.loading') }}</p>
  <p>{{ $t('cart.add_to_cart') }}</p>
  <p>{{ $t('elements.showing_n_of_total', { n: 16, total: 96 }) }}</p>
  <input :placeholder="$t('nav.search_products')" />
</template>

<script setup>
const { t } = useI18n();
const message = t('auth.login_failed');
</script>
```

## File Structure

```
app/locales/
  en.json    # English (default)
  sv.json    # Swedish
```

Locale files are **lazy-loaded** — only the active locale is included in the bundle.

## Key Naming

| Rule                        | Example                        |
| --------------------------- | ------------------------------ |
| snake_case                  | `add_to_cart`, not `addToCart` |
| Nested by domain            | `auth.login`, `cart.checkout`  |
| Descriptive, not positional | `login_failed`, not `error_1`  |

### Domains

| Domain     | Purpose                                         |
| ---------- | ----------------------------------------------- |
| `common`   | Shared UI: loading, error, cancel, save, search |
| `auth`     | Authentication: login, logout, register         |
| `nav`      | Navigation: home, products, cart                |
| `cart`     | Shopping cart: add, remove, checkout            |
| `product`  | Product pages: details, description, variants   |
| `account`  | Account portal: profile, orders, settings       |
| `elements` | Component showcase page                         |

## Usage Patterns

### In Templates

```vue
<!-- Simple key -->
<p>{{ $t('common.loading') }}</p>

<!-- With interpolation -->
<p>{{ $t('elements.showing_n_of_total', { n: count, total: totalCount }) }}</p>

<!-- In attributes (use :attr binding) -->
<input :placeholder="$t('nav.search_products')" />
```

### In Script

```typescript
const { t } = useI18n();
const errorMessage = t('auth.login_failed');
```

### In Pinia Stores

Do **not** call `useI18n()` inside Pinia actions — it requires a Vue composition API context that may not be available in tests or SSR edge cases.

Instead, store the **translation key** as a string. The component that displays the error uses `$t()` to translate it:

```typescript
// Store: use key string as fallback
actions: {
  async login(creds) {
    try { /* ... */ } catch (err) {
      this.error = err instanceof Error ? err.message : 'auth.login_failed'
    }
  }
}
```

```vue
<!-- Component: translate when displaying -->
<p v-if="authStore.error">{{ $t(authStore.error) }}</p>
```

## Interpolation

```json
{
  "welcome_back": "Welcome back, {name}!",
  "showing_n_of_total": "Showing {n} of {total} products"
}
```

```vue
{{ $t('welcome_back', { name: user.name }) }}
```

## Adding a New Locale

1. Create `app/locales/{code}.json` with all translation keys
2. Add the locale to `nuxt.config.ts`:
   ```typescript
   i18n: {
     locales: [
       // ...existing
       { code: 'de', name: 'Deutsch', file: 'de.json' },
     ],
   }
   ```
3. Ensure the tenant config includes the Geins locale code (e.g. `de-DE`) in its available locales

## Adding Translation Keys

1. Add the key to **all** locale files (`en.json`, `sv.json`, etc.)
2. Use the appropriate domain namespace
3. Keep values concise — these are UI labels, not documentation

## Tenant Locale Sync

- The `i18n-locale` plugin reads the tenant's `locale` field and calls `setLocale()`
- The `locale` cookie persists the user's preference across requests
- Server-side API routes can read the cookie via `getRequestLocale()` to pass the correct `languageId` to Geins GraphQL queries

## Server-Side Locale Override

All GraphQL services use `getRequestChannelVariables(sdk, event)` to automatically pipe the user's locale and market preferences into queries:

```typescript
// In a service function:
import { getTenantSDK, getRequestChannelVariables } from './_sdk';

export async function getProducts(options, event: H3Event) {
  const sdk = await getTenantSDK(event);
  return sdk.core.graphql.query({
    queryAsString: loadQuery('products.graphql'),
    variables: { ...options, ...getRequestChannelVariables(sdk, event) },
  });
}
```

This reads from:

- **Locale**: `locale` cookie (set by `@nuxtjs/i18n`)
- **Market**: `market` cookie (set via `setMarketCookie()`)

If no cookie is set, falls back to the tenant's default locale/market from SDK settings.
